<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>hunter-etl.transform documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Hunter-etl 0.3.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hunter-etl</span></div></div></li><li class="depth-2 branch"><a href="hunter-etl.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="hunter-etl.extract.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extract</span></div></a></li><li class="depth-2 branch"><a href="hunter-etl.load.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>load</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>portals</span></div></div></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-gouv-fr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-gouv-fr</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-gov.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-gov</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-gov-uk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-gov-uk</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-locale-fr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-locale-fr</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.energy-data-usa.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>energy-data-usa</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.open-canada.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>open-canada</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.opendata-europa.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opendata-europa</span></div></a></li><li class="depth-3"><a href="hunter-etl.portals.world-bank-data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>world-bank-data</span></div></a></li><li class="depth-2 branch current"><a href="hunter-etl.transform.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>transform</span></div></a></li><li class="depth-2"><a href="hunter-etl.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="hunter-etl.transform.html#var-create-ds"><div class="inner"><span>create-ds</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-deftransform"><div class="inner"><span>deftransform</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-hunter-keys"><div class="inner"><span>hunter-keys</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-keys-.3Ehunter-keys"><div class="inner"><span>keys-&gt;hunter-keys</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-map-get-in"><div class="inner"><span>map-get-in</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-not-hunter-keys"><div class="inner"><span>not-hunter-keys</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-with-count-check"><div class="inner"><span>with-count-check</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">hunter-etl.transform</h2><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-create-ds"><h3>create-ds</h3><div class="usage"><code>(create-ds title description publisher uri spatial temporal tags created updated resources reuses views)</code></div><div class="doc"><pre class="plaintext">create a hunter dataset by hand
eg.
(create-ds &quot;Global Bilateral Migration Database&quot;
&quot;Global ...&quot;  &quot;World Bank&quot; &quot;<a href="http://databank.w...&quot">http://databank.w...&quot</a>;
[&quot;World&quot; &quot;Africa&quot;] &quot;1960 - 2000&quot;
[&quot;migrants&quot;] &quot;2011-07-01T00:00:00.000000&quot;
&quot;2011-07-01T00:00:00.000000&quot; [] 5 0)</pre></div></div><div class="public anchor" id="var-deftransform"><h3>deftransform</h3><h4 class="type">macro</h4><div class="usage"><code>(deftransform name keys boolean fns-map)</code></div><div class="doc"><pre class="plaintext">Define a function that transform a collection of
dataset&apos;s metadata to make it meet the Hunter API
scheme.

The first argument is the name of the returned function

The second one is an array of the keys present in
the given collection of hashmaps and needed

The third is a map {:filter boolean?} (or {}) used to
filter the collection (filter the unpublished dataset
for exemple)

Then it takes a map of pairs :hunter-key [ƒ :old-key]
each function returns the final value of each key

e.g.

(deftransform dgf-transform
[:title :page :description :last_modified :organization
 :spatial :tags :temporal_coverage :resources :metrics]
{}
{:title       [identity :title]
 :description [notes-&gt;description :description :title]
 :publisher   [&quot;foo&quot;]
 :uri         [url-&gt;uri :page]
 :created     [get-created [:resources 0 :created_at] :last_modified]
 :updated     [identity :last_modified]
 :spatial     [(geo-tagify &quot;us&quot;]]
 :temporal    [get-temporal [:temporal_coverage :start] [:temporal_coverage :end]]
 :tags        [tags-with-title :title :tags]
 :resources   [filter-resources :resources]
 :huntscore   [str [:metrics :reuses] [:metrics :views]]})</pre></div></div><div class="public anchor" id="var-hunter-keys"><h3>hunter-keys</h3><div class="usage"></div><div class="doc"><pre class="plaintext">keys needed in the Hunter API
[:title :description :publisher
:uri :created :updated :spatial
:temporal :tags :resources :huntscore]</pre></div></div><div class="public anchor" id="var-keys-.3Ehunter-keys"><h3>keys-&gt;hunter-keys</h3><h4 class="type">macro</h4><div class="usage"><code>(keys-&gt;hunter-keys fns m)</code></div><div class="doc"><pre class="plaintext">
</pre></div></div><div class="public anchor" id="var-map-get-in"><h3>map-get-in</h3><h4 class="type">macro</h4><div class="usage"><code>(map-get-in m coll)</code></div><div class="doc"><pre class="plaintext">Given a map and a vector of key [f :key1 :key2]
returns (f (get-in map [:key1]) (get-in map [:key2]))

Used in the deftransform macro to avoid redundancy</pre></div></div><div class="public anchor" id="var-not-hunter-keys"><h3>not-hunter-keys</h3><div class="usage"><code>(not-hunter-keys vect)</code></div><div class="doc"><pre class="plaintext">keys on a collection that are not on the hunter-keys
</pre></div></div><div class="public anchor" id="var-with-count-check"><h3>with-count-check</h3><h4 class="type">macro</h4><div class="usage"><code>(with-count-check v &amp; body)</code></div><div class="doc"><pre class="plaintext">Macro that checks the count of a vector.
If the count is 1, it returns the element, if not it
returns the body.

Used in deftransform to allow to pass transformation
in two different ways:
* :key [ƒ :key1 :key2]
* :key [&apos;value&apos;]</pre></div></div></div></body></html>