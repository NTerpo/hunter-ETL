<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>hunter-etl.transform documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Hunter-etl 0.3.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hunter-etl</span></div></div></li><li class="depth-2 branch"><a href="hunter-etl.ckan.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ckan</span></div></a></li><li class="depth-2 branch"><a href="hunter-etl.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>portals</span></div></div></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-gouv-fr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-gouv-fr</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-gov.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-gov</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-gov-uk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-gov-uk</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.data-locale-fr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-locale-fr</span></div></a></li><li class="depth-3 branch"><a href="hunter-etl.portals.opendata-europa.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opendata-europa</span></div></a></li><li class="depth-3"><a href="hunter-etl.portals.world-bank-data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>world-bank-data</span></div></a></li><li class="depth-2 current"><a href="hunter-etl.transform.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>transform</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="hunter-etl.transform.html#var-api-url"><div class="inner"><span>api-url</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-calculate-huntscore"><div class="inner"><span>calculate-huntscore</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-create-ds"><div class="inner"><span>create-ds</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-deftransform"><div class="inner"><span>deftransform</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-extend-tags"><div class="inner"><span>extend-tags</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-extend-temporal"><div class="inner"><span>extend-temporal</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-geo-tagify"><div class="inner"><span>geo-tagify</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-get-result"><div class="inner"><span>get-result</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-hunter-keys"><div class="inner"><span>hunter-keys</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-load-to-hunter-api"><div class="inner"><span>load-to-hunter-api</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-map-get-in"><div class="inner"><span>map-get-in</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-not-hunter-keys"><div class="inner"><span>not-hunter-keys</span></div></a></li><li class="depth-1"><a href="hunter-etl.transform.html#var-tagify-title"><div class="inner"><span>tagify-title</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">hunter-etl.transform</h2><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-api-url"><h3>api-url</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-calculate-huntscore"><h3>calculate-huntscore</h3><div class="usage"><code>(calculate-huntscore reuses)</code><code>(calculate-huntscore reuses recent)</code><code>(calculate-huntscore reuses recent views)</code><code>(calculate-huntscore reuses recent views followers)</code></div><div class="doc"><pre class="plaintext">returns the sum of reuses, views/1000 recent-views/200 and followers/10
</pre></div></div><div class="public anchor" id="var-create-ds"><h3>create-ds</h3><div class="usage"><code>(create-ds title description publisher uri spatial temporal tags created updated resources reuses views)</code></div><div class="doc"><pre class="plaintext">create a hunter dataset by hand
eg. (create-ds &quot;Global Bilateral Migration Database&quot;
&quot;Global matrices of bilateral migrant stocks spanning
the period 1960-2000, disaggregated by gender and based
primarily on the foreign-born concept are presented.
Over one thousand census and population register records
are combined to construct decennial matrices corresponding
to the last five completed census rounds.\n\nFor the
first time, a comprehensive picture of bilateral global
migration over the last half of the twentieth century
emerges. The data reveal that the global migrant stock
increased from 92 to 165 million between 1960 and 2000
. South-North migration is the fastest growing component
of international migration in both absolute and relative
terms. The United States remains the most important migrant
destination in the world, home to one fifth of the world’s
migrants and the top destination for migrants from no less
than sixty sending countries. Migration to Western Europe
remains largely from elsewhere in Europe. The oil-rich
Persian Gulf countries emerge as important destinations
for migrants from the Middle East, North Africa and
South and South-East Asia. Finally, although the global
migrant stock is still predominantly male, the proportion
of women increased noticeably between 1960 and 2000.&quot;
&quot;World Bank&quot; &quot;<a href="http://databank.worldbank.org/data/views/">http://databank.worldbank.org/data/views/</a>
variableselection/selectvariables.aspx?source=global-bilateral
-migration&quot; [&quot;World&quot; &quot;East Asia &amp; Pacific&quot; &quot;Europe&quot; &quot;
Asia&quot; &quot;Latin America&quot; &quot;Caribbean&quot; &quot;Middle East&quot; &quot;North
Africa&quot; &quot;South Asia&quot; &quot;Sub Saharan&quot; &quot;Africa&quot;] &quot;1960 - 2000&quot;
[&quot;migrants&quot; &quot;immigration&quot;] &quot;2011-07-01T00:00:00.000000&quot;
&quot;2011-07-01T00:00:00.000000&quot; [] 5 0)</pre></div></div><div class="public anchor" id="var-deftransform"><h3>deftransform</h3><h4 class="type">macro</h4><div class="usage"><code>(deftransform name keys fns-map)</code></div><div class="doc"><pre class="plaintext">Define a function that transform a collection of
dataset&apos;s metadata to make it meet the Hunter API
scheme.

The first argument is the name of the returned function

The seconde one is an array of the keys present in
the given collection of hashmaps and needed

Then it takes a list of pairs: :hunter-key (ƒ :old-key)
each function returns the final value of each key

e.g.
(deftransform dgf-transform

[:title :page :description :last_modified :organization
 :spatial :tags :temporal_coverage :resources :metrics]

{:title       [identity :title]
 :description [notes-&gt;description :description :title]
 :publisher   [get-publisher [:organization :name]]
 :uri         [url-&gt;uri :page]
 :created     [get-created [:resources 0 :created_at] :last_modified]
 :updated     [identity :last_modified]
 :spatial     [clean-spatial [:spatial :territories]]
 :temporal    [get-temporal [:temporal_coverage :start] [:temporal_coverage :end]]
 :tags        [tags-with-title :title :tags]
 :resources   [filter-resources :resources]
 :huntscore   [str [:metrics :reuses] [:metrics :views]]})</pre></div></div><div class="public anchor" id="var-extend-tags"><h3>extend-tags</h3><div class="usage"><code>(extend-tags tags)</code></div><div class="doc"><pre class="plaintext">create new tags with the given tags vector by spliting words and cleaning
</pre></div></div><div class="public anchor" id="var-extend-temporal"><h3>extend-temporal</h3><div class="usage"><code>(extend-temporal temporal)</code></div><div class="doc"><pre class="plaintext">extend the temporal coverage with dates between limits
</pre></div></div><div class="public anchor" id="var-geo-tagify"><h3>geo-tagify</h3><div class="usage"><code>(geo-tagify geo)</code></div><div class="doc"><pre class="plaintext">extend the spatial coverage tagging &apos;us&apos;-&gt;&apos;america&apos;-&gt;&apos;countries&apos;-&gt;&apos;world&apos;
</pre></div></div><div class="public anchor" id="var-get-result"><h3>get-result</h3><div class="usage"><code>(get-result url)</code></div><div class="doc"><pre class="plaintext">gets metadata from an API and provides a first basic filter
</pre></div></div><div class="public anchor" id="var-hunter-keys"><h3>hunter-keys</h3><div class="usage"></div><div class="doc"><pre class="plaintext">keys needed in the Hunter API
</pre></div></div><div class="public anchor" id="var-load-to-hunter-api"><h3>load-to-hunter-api</h3><div class="usage"><code>(load-to-hunter-api coll)</code></div><div class="doc"><pre class="plaintext">Send each dataset to the Hunter API via method post
</pre></div></div><div class="public anchor" id="var-map-get-in"><h3>map-get-in</h3><h4 class="type">macro</h4><div class="usage"><code>(map-get-in m coll)</code></div><div class="doc"><pre class="plaintext">Given a map and a vector of key [f :key1 :key2]
returns (f (get-in map [:key1]) (get-in map [:key2]))

Used in the deftransform macro to avoid redundancy</pre></div></div><div class="public anchor" id="var-not-hunter-keys"><h3>not-hunter-keys</h3><div class="usage"><code>(not-hunter-keys vect)</code></div><div class="doc"><pre class="plaintext">keys on a collection that are not on the hunter-keys
</pre></div></div><div class="public anchor" id="var-tagify-title"><h3>tagify-title</h3><div class="usage"><code>(tagify-title title)</code></div><div class="doc"><pre class="plaintext">create new tags from the title
</pre></div></div></div></body></html>